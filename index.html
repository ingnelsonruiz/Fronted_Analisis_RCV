<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CardioCheck AI | Red de Prestadores</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');

body {
    font-family: 'Plus Jakarta Sans', sans-serif;
    background-color: #020617;
    color: #e5e7eb;
}

.glass {
    background: rgba(15, 23, 42, 0.75);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,.08);
    border-radius: 1.25rem;
}
</style>
</head>

<body class="p-6">

<!-- ================= HEADER ================= -->
<header class="max-w-7xl mx-auto mb-10 flex justify-between items-center">
    <div>
        <h1 class="text-3xl font-extrabold italic">
            CardioCheck <span class="text-blue-500">AI</span>
        </h1>
        <p class="text-slate-400 text-sm">Analítica Clínica • Red de Prestadores</p>
    </div>

    <div id="prestadorBox" class="glass px-5 py-3 hidden">
        <p class="text-[10px] uppercase text-slate-400 font-bold">Prestador Analizado</p>
        <p id="prestadorNombre" class="font-extrabold text-blue-400"></p>
    </div>
</header>

<!-- ================= MAIN ================= -->
<main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">

<!-- ====== PANEL CARGA ====== -->
<section class="lg:col-span-4">
    <div class="glass p-8 space-y-6">
        <h2 class="font-black text-lg flex gap-2">
            <i data-lucide="upload-cloud"></i> Cargar Cohorte CSV
        </h2>

        <div id="dropzone" class="border-2 border-dashed border-slate-700 rounded-xl p-6 text-center cursor-pointer hover:border-blue-500">
            <input type="file" id="fileInput" accept=".csv" hidden>
            <p id="fileName" class="text-sm text-slate-400 font-bold">Seleccione archivo CSV</p>
        </div>

        <button id="btnAnalizar" onclick="analizar()" class="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded-xl font-black">
            <i data-lucide="activity"></i> ANALIZAR COHORTE
        </button>
    </div>
</section>

<!-- ====== RESULTADOS ====== -->
<section class="lg:col-span-8 space-y-6">

<div id="placeholder" class="glass h-60 flex flex-col justify-center items-center text-slate-500">
    <i data-lucide="heart-pulse" class="w-12 h-12 mb-3"></i>
    <p class="font-bold">Espere el análisis clínico</p>
</div>

<div id="resultados" class="hidden space-y-6">

<!-- KPIs -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="glass p-5"><p class="text-xs text-slate-400">Pacientes</p><h3 id="kTotal" class="text-2xl font-black">-</h3></div>
    <div class="glass p-5 border-l-4 border-red-500"><p class="text-xs text-red-400">Riesgo Alto</p><h3 id="kAlto" class="text-2xl font-black">-</h3></div>
    <div class="glass p-5 border-l-4 border-yellow-500"><p class="text-xs text-yellow-400">Riesgo Moderado</p><h3 id="kMod" class="text-2xl font-black">-</h3></div>
    <div class="glass p-5 border-l-4 border-green-500"><p class="text-xs text-green-400">Riesgo Bajo</p><h3 id="kBajo" class="text-2xl font-black">-</h3></div>
</div>

<!-- Pacientes críticos -->
<div class="glass p-6">
    <h2 class="font-black mb-4 flex gap-2"><i data-lucide="alert-triangle"></i> Pacientes Prioritarios</h2>
    <div class="overflow-auto max-h-64">
        <table class="w-full text-sm">
            <thead class="text-slate-400">
                <tr>
                    <th class="text-left">Paciente</th>
                    <th>Edad</th>
                    <th>Riesgo</th>
                    <th>Alertas</th>
                </tr>
            </thead>
            <tbody id="tablaPacientes"></tbody>
        </table>
    </div>
</div>

<!-- Informe IA -->
<div class="glass p-6">
    <h2 class="font-black mb-4 flex gap-2"><i data-lucide="file-text"></i> Informe Médico IA</h2>
    <div id="informeIA" class="text-sm text-slate-300 space-y-3 max-h-[400px] overflow-y-auto"></div>
</div>

</div>
</section>
</main>

<script>
lucide.createIcons();

const fileInput = document.getElementById('fileInput');
document.getElementById('dropzone').onclick = () => fileInput.click();
fileInput.onchange = () => document.getElementById('fileName').innerText = fileInput.files[0]?.name || "";

async function analizar() {
    if (!fileInput.files[0]) return alert("Suba un archivo CSV");

    document.getElementById('btnAnalizar').innerText = "Analizando...";

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    const res = await fetch("https://analisis-rcv.onrender.com/analizar", {
        method: "POST",
        body: formData
    });

    const data = await res.json();

    document.getElementById('placeholder').classList.add('hidden');
    document.getElementById('resultados').classList.remove('hidden');

    document.getElementById('prestadorBox').classList.remove('hidden');
    document.getElementById('prestadorNombre').innerText = data.prestador;

    document.getElementById('kTotal').innerText = data.total_registros;
    document.getElementById('kAlto').innerText = data.riesgo_alto;
    document.getElementById('kMod').innerText = data.riesgo_moderado;
    document.getElementById('kBajo').innerText = data.riesgo_bajo;

    // Tabla pacientes
    const tbody = document.getElementById('tablaPacientes');
    tbody.innerHTML = "";
    data.pacientes_prioritarios.forEach(p => {
        tbody.innerHTML += `
        <tr class="border-b border-slate-700">
            <td>${p.nombre}</td>
            <td class="text-center">${p.edad}</td>
            <td class="text-center font-bold">${p.riesgo}</td>
            <td class="text-xs">${p.alertas.join(", ")}</td>
        </tr>`;
    });

    // Informe IA
    document.getElementById('informeIA').innerText = data.analisis_ia;

    document.getElementById('btnAnalizar').innerText = "ANALIZAR COHORTE";
    lucide.createIcons();
}
</script>
</body>
</html>
